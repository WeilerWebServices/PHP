<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 349754 Maintainer: takagi Status: ready -->
<!-- Credits: mumumu -->

<appendix xml:id="migration55" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>PHP 5.4.x から PHP 5.5.x への移行</title>
 <simpara>
  &manual.migration.seealso;
  <link linkend="migration5">5.0.x</link>、
  <link linkend="migration51">5.1.x</link>、
  <link linkend="migration52">5.2.x</link>、
  <link linkend="migration53">5.3.x</link>、
  <link linkend="migration54">5.4.x</link>、
  <link linkend="migration56">5.6.x</link> および
  <link linkend="migration70">7.0.x</link>。
 </simpara>

 <sect1 xml:id="migration55.changes">
  <title>PHP 5.5.x における変更点</title>
  <simpara>
   PHP 5.5.x で改良された点のほどんどは、既存のコードに影響を及ぼしません。ただ、
   <link linkend="migration55.incompatible">互換性がない変更</link> や 考慮すべき
   <link linkend="migration55.new-features">新機能</link> があります。よって、
   実運用環境の PHP をこのバージョンにあげる前に、あらゆるコードをテストすべきです。
  </simpara>
  <simpara>
   5.4.x より古いバージョンの PHP からのアップグレードの場合は、
   以下の関連ドキュメントも参照ください。
  </simpara>
  <itemizedlist>
   <listitem>
    <simpara>
     <link linkend="migration54">PHP 5.4.x への移行</link>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <link linkend="migration53">PHP 5.3.x への移行</link>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <link linkend="migration52">PHP 5.2.x への移行</link>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <link linkend="migration51">PHP 5.1.x への移行</link>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <link linkend="migration5">PHP 4 から PHP 5 への移行</link>
    </simpara>
   </listitem>
  </itemizedlist>
 </sect1>

 <sect1 xml:id="migration55.incompatible">
  <title>下位互換性のない変更点</title>
  <simpara>
   既存の PHP5 のコードのほとんどは変更なしで動作するはずですが、
   以下の下位互換性のない変更点については注意しましょう。
  </simpara>
  
  <sect2 xml:id="migration55.incompatible.windows">
   <title>Windows XP および 2003 のサポートの終了</title>
   
   <para>
    Windows XP および 2003 はサポートされなくなります。
    Windows 版の PHP は、Windows Vista 以降でしか動かなくなります。
   </para>
  </sect2>

  <sect2 xml:id="migration55.incompatible.case">
   <title>大文字小文字を区別しない比較がロケールに依存しなくなる</title>
   
   <para>
    関数名やクラス名そして定数名は大文字小文字を区別しませんが、
    このマッチ方法が ASCII のルールに基づいたロケールに依存しない動きに変わります。
    ラテンアルファベットを通常とは異なる照合規則で使っている言語
    (トルコ語やアゼルバイジャン語など) にきちんと対応するようになりました。
   </para>
   <para>
    これは、マルチバイト文字セット (UTF-8 も含む) で非 ASCII
    文字に対して大文字小文字を区別しないマッチングをしているコードで問題になるかもしれません。
    ヨーロッパ諸国語のアクセント記号などがこれにあてはまります。
    英語以外の非 ASCII コードベースを使っている場合は、
    無意識のうちにこの振る舞いに依存してしまっていないかどうかを確かめてから
    PHP 5.5 を実運用環境に投入するようにしましょう。
   </para>
  </sect2>

  <sect2 xml:id="migration55.incompatible.pack">
   <title><function>pack</function> と <function>unpack</function> の変更</title>

   <para>
    <function>pack</function> と
    <function>unpack</function> が、より Perl との互換性を高めるように変更されました。
   </para>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>pack</function> が書式文字 "Z" に対応しました。この文字の挙動は
      "a" とまったく同じです。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>unpack</function> も書式文字 "Z" に対応しました。これは
      NULL 埋めの文字列に使うもので、以前のバージョンの "a" と同じ挙動です。
      最後の NULL バイトは切り捨てます。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>unpack</function> で書式文字 "a" を使ったときに、
      最後の NULL バイトを維持するようになりました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>unpack</function> で書式文字 "A" を使ったときに、
      最後の ASCII 空白文字をすべて切り捨てるようになりました。
     </simpara>
    </listitem>
   </itemizedlist>

   <para>
    <function>unpack</function> で "a" を使っているコードで過去のバージョンとの互換性を保つには、
    <function>version_compare</function> を使う必要があります。
    過去との互換性が崩れてしまったからです。
   </para>
   <para>
    たとえば、このようにします。
   </para>
   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
// 古いコード
$data = unpack('a5', $packed);

// 新しいコード
if (version_compare(PHP_VERSION, '5.5.0-dev', '>=')) {
  $data = unpack('Z5', $packed);
} else {
  $data = unpack('a5', $packed);
}
?>
]]>
    </programlisting>
   </informalexample>
  </sect2>
  <sect2 xml:id="migration55.incompatible.json">
   <title><function>json_encode</function> 関数に対する変更</title>
   <para>
    <function>json_encode</function> に渡した <parameter>value</parameter> 引数が JSON
    エンコーディングとしてエラーだった場合、 一部を出力する代わりに &false; を返すようになりました。
    <parameter>options</parameter> に <constant>JSON_PARTIAL_OUTPUT_ON_ERROR</constant>
    が含まれていた場合は、これまで通り一部を出力します。
    JSON エンコーディングが失敗した理由の一覧をすべて見るには、
    <function>json_last_error</function> を参照してください。
    可能性がある理由の一つは、<parameter>value</parameter> に不正や UTF-8 文字列が含まれていることです。
   </para>
  </sect2>

  <sect2 xml:id="migration55.incompatible.self-parent-static">
   <title><literal>self</literal> や <literal>parent</literal> そして <literal>static</literal>
   が、どんな場合であっても大文字小文字を区別しないようになる</title>

   <para>
    PHP 5.5 より前のバージョンでは、キーワード
    <link linkend="language.oop5.paamayim-nekudotayim">self</link>、
    <link linkend="language.oop5.paamayim-nekudotayim">parent</link> そして
    <link linkend="language.oop5.late-static-bindings">static</link>
    について大文字小文字を区別した扱いになる場合がありました。
    この問題は解決し、PHP 5.5 からはどんな場合であっても大文字小文字を区別しないようになります。
    つまり、<literal>SELF::CONSTANT</literal> と
    <literal>self::CONSTANT</literal> はまったく同じ扱いになるということです。
   </para>
  </sect2>

  <sect2 xml:id="migration55.incompatible.guid">
   <title>PHP ロゴの GUID の削除</title>

   <para>
    PHP でいろいろなロゴを出すために使われていた GUID が削除されました。
    それに伴って、GUID を返す関数も削除されました。削除された関数は次のとおりです。
   </para>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>php_logo_guid</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>php_egg_logo_guid</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>php_real_logo_guid</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>zend_logo_guid</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.incompatible.execution">
   <title>内部的な実行方法の変更</title>

   <para>
    拡張モジュールの作者が注意すべきなのは、<command>zend_execute()</command>
    関数がオーバーライドできなくなったということです。さらに、
    <literal>execute_data</literal> 構造体やそれに関連する関数、
    そしてオペコードを扱うメソッドにもさまざまな変更がありました。
   </para>

   <para>
    この変更の影響を受ける拡張モジュールはほとんどないでしょう。
    しかし、Zend Engine の内部に深く食い込んだ拡張モジュールを書いている人は、
    <link linkend="migration55.internals">変更点に関するメモ</link>
    をしっかり読んでおきましょう。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.new-features">
  <title>新機能</title>

  <sect2 xml:id="migration55.new-features.generators">
   <title><link linkend="language.generators">ジェネレータ</link>の追加</title>

   <para>
    <link linkend="language.generators">ジェネレータ</link>が追加されました。
    <command>yield</command> キーワードで利用します。
    ジェネレータを使えば、シンプルなイテレータを簡単に実装できます。
    <classname>Iterator</classname> インターフェイスを実装したクラスを用意する
    オーバーヘッドや複雑さを心配する必要はありません。
   </para>

   <para>
    <function>range</function> 関数をジェネレータで実装しなおす例を示します
    (<literal>step</literal> には正の値しか使えません)。
   </para>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
function xrange($start, $limit, $step = 1) {
    for ($i = $start; $i <= $limit; $i += $step) {
        yield $i;
    }
}

echo 'Single digit odd numbers: ';

/*
 * 配列を作ったり配列を返したりしていないことに注目しましょう。
 * そのぶんメモリの節約になります。
 */
foreach (xrange(1, 9, 2) as $number) {
    echo "$number ";
}

echo "\n";
?>
]]>
    </programlisting>
    &example.outputs;
    <screen>
<![CDATA[
Single digit odd numbers: 1 3 5 7 9 
]]>
    </screen>
   </informalexample>
  </sect2>

  <sect2 xml:id="migration55.new-features.finally">
   <title>&finally; キーワードの追加</title>

   <para>
    &try;-&catch; ブロックで &finally; が使えるようになりました。
    例外が発生したかどうかに関わらず
    必ず実行しないといけないコードをここに書きます。
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.password">
   <title>新しいパスワードハッシュ API</title>

   <para>
    <link linkend="book.password">新しいパスワードハッシュ API</link>
    が用意され、より簡単にパスワードをハッシュしたり管理したりできるようになりました。
    PHP の <function>crypt</function> が使っているのと同じライブラリを利用します。
    詳細は <function>password_hash</function> のドキュメントを参照ください。
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.foreach-list">
   <title><link linkend="control-structures.foreach"><literal>foreach</literal></link> が <function>list</function> に対応</title>

   <para>
    <link linkend="control-structures.foreach">foreach</link>
    で <function>list</function> を使って、
    ネストした配列を個別の変数に展開できるようになりました。たとえば次のようになります。
   </para>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
$array = [
    [1, 2],
    [3, 4],
];

foreach ($array as list($a, $b)) {
    echo "A: $a; B: $b\n";
}
?>
]]>
    </programlisting>
    &example.outputs;
    <screen>
<![CDATA[
A: 1; B: 2
A: 3; B: 4
]]>
    </screen>
   </informalexample>

   <para>
    詳細な情報は
    <link linkend="control-structures.foreach.list">foreach</link>
    のマニュアルを参照ください。
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.empty">
   <title><function>empty</function> が任意の式に対応</title>

   <para>
    変数だけでなく、任意の式を
    <function>empty</function> に渡せるようになりました。たとえば次のようになります。
   </para>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
function always_false() {
    return false;
}

if (empty(always_false())) {
    echo "This will be printed.\n";
}

if (empty(true)) {
    echo "This will not be printed.\n";
}
?>
]]>
    </programlisting>
    &example.outputs;
    <screen>
<![CDATA[
This will be printed.
]]>
    </screen>
   </informalexample>
  </sect2>

  <sect2 xml:id="migration55.new-features.const-dereferencing">
   <title><type>array</type> リテラルと <type>string</type> リテラルのデリファレンス</title>

   <para>
    <type>Array</type> と <type>string</type> をデリファレンスして、
    個々の要素や文字に直接アクセスできるようになりました。

    <informalexample>
     <programlisting role="php">
<![CDATA[
<?php
echo 'Array dereferencing: ';
echo [1, 2, 3][0];
echo "\n";

echo 'String dereferencing: ';
echo 'PHP'[0];
echo "\n";
?>
]]>
     </programlisting>
     &example.outputs;
     <screen>
<![CDATA[
Array dereferencing: 1
String dereferencing: P
]]>
     </screen>
    </informalexample>
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.class-name">
   <title><link linkend="language.oop5.basic.class.class">::class</link> によるクラス名の解決</title>

   <para>
    <literal>ClassName::class</literal> で、
    <literal>ClassName</literal> クラスの完全修飾名を取得できるようになりました。
    次の例を参照ください。

    <informalexample>
     <programlisting role="php">
<![CDATA[
<?php
namespace Name\Space;
class ClassName {}

echo ClassName::class;

echo "\n";
?>
]]>
     </programlisting>
     &example.outputs;
     <screen>
<![CDATA[
Name\Space\ClassName
]]>
     </screen>
    </informalexample>
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.opcache">
   <title><link linkend="book.opcache">OPcache</link> 拡張モジュールの追加</title>

   <para>
    Zend Optimiser+ のオペコードキャッシュ機能が、
    <link linkend="book.opcache">OPcache 拡張モジュール</link>
    としてPHP に追加されました。
    OPcache は、PHP のパフォーマンスを向上させるために、
    事前にコンパイル済みのスクリプトのバイトコードを共有メモリに格納します。
    その結果、PHP がリクエストのたびにスクリプトの読み込みやパースをする必要がなくなります。
    OPcache を有効にする方法や使いかたについては
    <link linkend="opcache.installation">インストール</link>
    のページを参照ください。
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.non-scalar-iterator-keys">
   <title><link linkend="control-structures.foreach"><literal>foreach</literal></link>
   が非スカラーのキーに対応</title>

   <para>
    <link linkend="control-structures.foreach">foreach</link>
    が、キーに任意の型を使えるようになりました。
    非スカラーのキーは PHP ネイティブの配列では使えませんが、
    <methodname>Iterator::key</methodname> は任意の型の値を返せ、
    これを適切に処理できるようになりました。
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.windows-apache">
   <title>Apache 2.4 ハンドラが Windows に対応</title>

   <para>
    Apache 2.4 ハンドラ SAPI が Windows に対応するようになりました。
   </para>
  </sect2>

  <sect2 xml:id="migration55.new-features.gd">
   <title>GD の改良</title>

   <para>
    GD 拡張モジュールに、さまざまな改良が加えられました。
   </para>

   <itemizedlist>
    <listitem>
     <simpara>
      新しい <function>imageflip</function> 関数で、画像の反転に対応しました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>imagecrop</function> 関数と
      <function>imagecropauto</function> 関数で、高度なクロップ処理に対応しました。
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.deprecated">
  <title>PHP 5.5.x で推奨されなくなる機能</title>

  <sect2 xml:id="migration55.deprecated.mysql">
   <title><link linkend="book.mysql">ext/mysql</link> 拡張モジュール</title>

   <para>
    <link linkend="book.mysql">MySQL 拡張モジュール</link>
    が非推奨になりました。これを使ってデータベースに接続すると、
    <constant>E_DEPRECATED</constant> エラーが発生します。
    かわりに
    <link linkend="book.mysqli">MySQLi</link> あるいは
    <link linkend="ref.pdo-mysql">PDO_MySQL</link> を使いましょう。
   </para>
  </sect2>

  <sect2 xml:id="migration55.deprecated.preg-replace-e">
   <title><function>preg_replace</function> の <literal>/e</literal> 修飾子</title>

   <para>
    <function>preg_replace</function> の <literal>/e</literal>
    修飾子が非推奨になりました。かわりに
    <function>preg_replace_callback</function> 関数を使いましょう。
   </para>
  </sect2>

  <sect2 xml:id="migration55.deprecated.intl">
   <title><link linkend="book.intl">intl</link> での非推奨</title>

   <para>
    <methodname>IntlDateFormatter::setTimeZoneID</methodname> と
    <function>datefmt_set_timezone_id</function> が非推奨になりました。かわりに、
    <methodname>IntlDateFormatter::setTimeZone</methodname> メソッドと
    <function>datefmt_set_timezone</function> 関数を使いましょう。
   </para>
  </sect2>

  <sect2 xml:id="migration55.deprecated.mcrypt">
   <title><link linkend="book.mcrypt">mcrypt</link> での非推奨</title>

   <simpara>
    次の関数が非推奨になりました。
   </simpara>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>mcrypt_cbc</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>mcrypt_cfb</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>mcrypt_ecb</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>mcrypt_ofb</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.changed-functions">
  <title>変更された関数</title>

  <sect2 xml:id="migration55.changed-functions.core">
   <title>PHP コア</title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>set_error_handler</function> の引数に &null; を渡して呼ぶと、
      エラーハンドラをリセットできるようになりました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      &null; を渡して呼んだ場合の <function>set_error_handler</function> と
      <function>set_exception_handler</function> の返り値は、
      それぞれ以前のエラーハンドラと例外ハンドラになります。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>json_encode</function> に <parameter>depth</parameter>
      パラメータを渡せるようになりました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>pack</function> と
      <function>unpack</function> で "a" や "A" を使ったときの挙動が変わりました。
      <link linkend="migration55.incompatible.pack">詳細はこちらを参照ください</link>。
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.changed-functions.intl">
   <title><link linkend="book.intl">intl</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <methodname>MessageFormatter::format</methodname> とその関連関数で、
      名前付き引数に対応しました。数値引数との混在も可能です。
      これは、PHP を ICU 4.8 以降とリンクした場合に有効になります。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>MessageFormatter::format</methodname> とその関連関数で、
      引数の数を間違えた場合にエラーが発生しなくなりました。
      ただし、プレースホルダの置換は行われません。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>MessageFormatter::format</methodname> と
      <methodname>MessageFormatter::parse</methodname> で時刻を扱うときに、
      秒単位の精度に縛られなくなりました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>IntlDateFormatter::__construct</methodname> と
      <function>datefmt_create</function> の
      <parameter>timezone</parameter> 引数で
      <classname>IntlTimeZone</classname> や
      <classname>DateTimeZone</classname> のオブジェクトが使えるようになり、同じく
      <parameter>calendar</parameter> 引数で
      <classname>IntlCalendar</classname> オブジェクトが使えるようになりました。
      さらに、タイムゾーンが省略されていて <parameter>calendar</parameter>
      でタイムゾーンが指定されていない場合は、ICU のデフォルトタイムゾーンではなく
      PHP のデフォルトタイムゾーン
      (<function>date_default_timezone_get</function> の返す値)
      を使うようになりました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <classname>IntlDateFormatter</classname> オブジェクトを作るときに
      <classname>IntlDateFormatter</classname> の定数ではなく
      <classname>IntlCalendar</classname> のインスタンスを使った場合に、
      <methodname>IntlDateFormatter::getCalendar</methodname> と
      <function>datefmt_get_calendar</function> が false を返すようになりました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>IntlDateFormatter::setCalendar</methodname> と
      <function>datefmt_set_calendar</function> で、
      <classname>IntlDateFormatter</classname> の定数以外に
      <classname>IntlCalendar</classname> オブジェクトも受け付けるようになりました。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>IntlDateFormatter::format</methodname> と
      <function>datefmt_format</function> で
      <classname>IntlCalendar</classname> オブジェクトが使えるようになりました。
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.new-functions">
  <title>新しい関数</title>

  <sect2 xml:id="migration55.new-functions.core">
   <title>PHP コア</title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>array_column</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>boolval</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>json_last_error_msg</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>password_get_info</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>password_hash</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>password_needs_rehash</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>password_verify</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.new-functions.hash">
   <title><link linkend="book.hash">Hash</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>hash_pbkdf2</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.new-functions.openssl">
   <title><link linkend="book.openssl">OpenSSL</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>openssl_pbkdf2</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.new-functions.curl">
   <title><link linkend="book.curl">cURL</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>curl_escape</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_file_create</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_multi_setopt</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_multi_strerror</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_pause</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_reset</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_share_close</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_share_init</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_share_setopt</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_strerror</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>curl_unescape</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.new-functions.gd">
   <title><link linkend="book.image">GD</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>imageaffinematrixconcat</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>imageaffinematrixget</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>imagecrop</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>imagecropauto</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>imageflip</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>imagepalettetotruecolor</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>imagescale</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
  
  <sect2 xml:id="migration55.new-functions.mysqli">
   <title><link linkend="book.mysqli">MySQLi</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>mysqli_begin_transaction</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>mysqli_release_savepoint</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>mysqli_savepoint</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
  
  <sect2 xml:id="migration55.new-functions.pgsql">
   <title><link linkend="book.pgsql">PostgreSQL</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>pg_escape_literal</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>pg_escape_identifier</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.new-functions.sockets">
   <title><link linkend="book.sockets">Sockets</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>socket_sendmsg</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>socket_recvmsg</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>socket_cmsg_space</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>  

  <sect2 xml:id="migration55.new-functions.cli">
   <title><link linkend="features.commandline">CLI</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>cli_get_process_title</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>cli_set_process_title</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
  
  <sect2 xml:id="migration55.new-functions.intl">
   <title><link linkend="book.intl">Intl</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <function>datefmt_format_object</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>datefmt_get_calendar_object</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>datefmt_get_timezone</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>datefmt_set_timezone</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>datefmt_get_calendar_object</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_create_instance</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_keyword_values_for_locale</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_now</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_available_locales</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_time</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_set_time</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_add</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_set_time_zone</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_after</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_before</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_set</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_roll</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_clear</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_field_difference</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_actual_maximum</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_actual_minimum</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_day_of_week_type</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_first_day_of_week</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_greatest_minimum</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_least_maximum</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_locale</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_maximum</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_minimal_days_in_first_week</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_minimum</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_time_zone</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_type</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_weekend_transition</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_in_daylight_time</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_is_equivalent_to</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_is_lenient</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_is_set</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_is_weekend</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_set_first_day_of_week</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_set_lenient</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_equals</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_repeated_wall_time_option</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_skipped_wall_time_option</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_set_repeated_wall_time_option</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_set_skipped_wall_time_option</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_from_date_time</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_to_date_time</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_error_code</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlcal_get_error_message</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlgregcal_create_instance</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlgregcal_set_gregorian_change</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlgregcal_get_gregorian_change</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intlgregcal_is_leap_year</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_create_time_zone</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_create_default</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_id</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_gmt</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_unknown</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_create_enumeration</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_count_equivalent_ids</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_create_time_zone_id_enumeration</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_canonical_id</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_region</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_tz_data_version</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_equivalent_id</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_use_daylight_time</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_offset</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_raw_offset</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_has_same_rules</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_display_name</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_dst_savings</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_from_date_time_zone</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_to_date_time_zone</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_error_code</function>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <function>intltz_get_error_message</function>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.new-features.spl">
   <title><link linkend="book.spl">SPL</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <methodname>SplFixedArray::__wakeup</methodname>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.classes">
  <title>新しいクラスやインターフェイス</title>

  <sect2 xml:id="migration55.classes.curl">
   <title><link linkend="book.curl">cURL</link></title>
   <itemizedlist>
    <listitem>
     <simpara>
      <classname>CURLFile</classname>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
  
  <sect2 xml:id="migration55.classes.datetime">
   <title><link linkend="book.datetime">日付と時刻</link></title>
   <itemizedlist>
    <listitem>
     <simpara>
      <classname>DateTimeImmutable</classname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <classname>DateTimeInterface</classname>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
  
  <sect2 xml:id="migration55.classes.intl">
   <title><link linkend="book.intl">Intl</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <classname>IntlCalendar</classname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <classname>IntlGregorianCalendar</classname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <classname>IntlTimeZone</classname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <classname>IntlBreakIterator</classname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <classname>IntlRuleBasedBreakIterator</classname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <classname>IntlCodePointBreakIterator</classname>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.new-methods">
  <title>新しいメソッド</title>

  <sect2 xml:id="migration55.new-methods.mysqli">
   <title><link linkend="book.mysqli">MySQLi</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <methodname>mysqli::begin_transaction</methodname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>mysqli::release_savepoint</methodname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>mysqli::savepoint</methodname>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
  
  <sect2 xml:id="migration55.new-methods.intl">
   <title><link linkend="book.intl">Intl</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <methodname>IntlDateFormatter::formatObject</methodname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>IntlDateFormatter::getCalendarObject</methodname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>IntlDateFormatter::getTimeZone</methodname>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <methodname>IntlDateFormatter::setTimeZone</methodname>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.extensions-other">
  <title>その他の拡張モジュールに対する変更</title>

  <sect2 xml:id="migration55.extensions-other.intl">
   <title><link linkend="book.intl">Intl</link></title>

   <para>
    <link linkend="book.intl">intl</link> 拡張モジュールで ICU 4.0 以降が必要になりました。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.global-constants">
  <title>新しいグローバル定数</title>

  <sect2 xml:id="migration55.global-constants.gd">
   <title><link linkend="book.image">GD</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <constant>IMG_AFFINE_TRANSLATE</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_AFFINE_SCALE</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_AFFINE_ROTATE</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_AFFINE_SHEAR_HORIZONTAL</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_AFFINE_SHEAR_VERTICAL</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_CROP_DEFAULT</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_CROP_TRANSPARENT</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_CROP_BLACK</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_CROP_WHITE</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_CROP_SIDES</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_FLIP_BOTH</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_FLIP_HORIZONTAL</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_FLIP_VERTICAL</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_BELL</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_BESSEL</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_BICUBIC</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_BICUBIC_FIXED</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_BLACKMAN</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_BOX</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_BSPLINE</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_CATMULLROM</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_GAUSSIAN</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_GENERALIZED_CUBIC</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_HERMITE</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_HAMMING</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_HANNING</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_MITCHELL</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_POWER</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_QUADRATIC</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_SINC</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_NEAREST_NEIGHBOUR</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_WEIGHTED4</constant>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <constant>IMG_TRIANGLE</constant>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.global-constants.json">
   <title><link linkend="book.json">JSON</link></title>

   <itemizedlist>
    <listitem>
     <simpara>
      <link linkend="constant.json-error-recursion"><constant>JSON_ERROR_RECURSION</constant></link>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <link linkend="constant.json-error-inf-or-nan"><constant>JSON_ERROR_INF_OR_NAN</constant></link>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <link linkend="constant.json-error-unsupported-type"><constant>JSON_ERROR_UNSUPPORTED_TYPE</constant></link>
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <link linkend="constant.json-partial-output-on-error"><constant>JSON_PARTIAL_OUTPUT_ON_ERROR</constant></link>
     </simpara>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="migration55.global-constants.mysqli">
   <title><link linkend="book.mysqli">MySQLi</link></title>

   <para>
    <constant>MYSQLI_SERVER_PUBLIC_KEY</constant> オプションが追加されました。
    <function>mysqli_options</function> で使えます。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.ini">
  <title>INI ファイルの扱いに関する変更</title>

  <sect2 xml:id="migrations55.ini.intl">
   <title><link linkend="book.intl">Intl</link></title>

   <para>
    <literal>intl.use_exceptions</literal> が追加されました。
    これは、グローバルエラーが発生した場合の intl の挙動を制御するもので、
    既に存在する <literal>intl.error_level</literal>
    と組み合わせて使います。
   </para>
  </sect2>

  <sect2 xml:id="migration55.ini.mysqlnd">
   <title><link linkend="book.mysqlnd">MySQLnd</link></title>

   <para>
    <link linkend="ini.mysqlnd.sha256-server-public-key">mysqlnd.sha256_server_public_key</link> が追加されました。
    <link linkend="book.mysqli">mysqli</link> で、新たな MySQL
    認証プロトコルが使えるようになります。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="migration55.internals">
  <title>PHP の内部的な変更</title>

  <itemizedlist>
   <listitem>
    <simpara>
     拡張モジュールで <command>zend_execute()</command> をオーバーライドできなくなりました。
     かわりに <command>zend_execute_ex()</command> をオーバーライドしないといけません。
     <literal>EG(current_execute_data)</literal> は既に
     <command>zend_execute_ex()</command> で初期化されるようになっているので、
     互換性を保つために拡張モジュール側で
     <literal>EG(current_execute_data)-&gt;prev_execute_data</literal> を使わないといけないかもしれません。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <literal>EG(arg_types_stack)</literal> や
     <literal>EX(fbc)</literal>、<literal>EX(called_scope)</literal>、そして
     <literal>EX(current_object)</literal> が削除されました。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <literal>op_array-&gt;nested_calls</literal> が追加されました。
     これはコンパイル時に計算されます。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <literal>EX(call_slots)</literal> が追加されました。これは、構文的にネストした呼び出し
     (<literal>foo(bar())</literal> など) に関する情報を格納する配列で、
     <literal>execute_data</literal> とともに事前に割り当てられます。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <literal>EX(call)</literal> が追加されました。これは現在呼び出し中の関数へのポインタで、
     <literal>EX(call_slots)</literal> の要素になります。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     オペコード
     <link linkend="internals2.opcodes.init-method-call">INIT_METHOD_CALL</link>、
     <link linkend="internals2.opcodes.init-static-method-call">ZEND_INIT_STATIC_METHOD_CALL</link>、
     <link linkend="internals2.opcodes.init-fcall-by-name">ZEND_INIT_FCALL_BY_NAME</link>
     そして
     <link linkend="internals2.opcodes.init-ns-fcall-by-name">ZEND_INIT_NS_FCALL_BY_NAME</link>
     が、
     <literal>EX(call_slots)</literal> でのインデックスとして
     <literal>result.num</literal> を使うようになりました。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     オペコード <link linkend="internals2.opcodes.new">ZEND_NEW</link>
     が、
     <literal>EX(call_slots)</literal> でのインデックスとして
     <literal>extended_value</literal> を使うようになりました。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     オペコード <link linkend="internals2.opcodes.do-fcall">ZEND_DO_FCALL</link>
     および
     <link linkend="internals2.opcodes.do-fcall-by-name">ZEND_DO_FCALL_BY_NAME</link>
     が、
     <literal>EX(call_slots)</literal> でのインデックスとして
     <literal>op2.num</literal> を使うようになりました。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <literal>op_array-&gt;used_stack</literal> が追加されました。
     これはコンパイル時に計算されます。対応するスタック領域は
     <literal>execute_data</literal> とともに事前に割り当てられます。
     その結果、オペコード ZEND_SEND* および ZEND_DO_FCALL*
     でスタックオーバーフローのチェックが不要になりました。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <literal>execute_data-&gt;Ts</literal> フィールドが削除されました。
     VM のテンポラリ変数は常に
     <literal>execute_data</literal> 構造体の直前に配置され、
     <literal>execute_data-&gt;Ts</literal> を使わなくても
     基底ポインタ <literal>execute_data</literal> からのオフセットでアクセスできるようになりました。
     コンパイラは、この新たなオフセットを <literal>op_array-&gt;opcodes[*].op?.num</literal>
     に格納します。マクロ
     <command>EX_TMP_VAR()</command> および <command>EX_TMP_VAR_NUM()</command>
     を使うと、テンポラリ変数に対してオフセットや数値を使ってアクセスできます。
     数字をオフセットに変換するには <command>EX_TMP_VAR_NUM(0,
     num)</command> を、そしてオフセットを数字に変換するには
     <command>(EX_TMP_VAR_NUM(0,0)-EX_TMP_VAR(0,offset))</command>
     が使えます。
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <literal>execute_data-&gt;CVs</literal> フィールドが削除されました。
     VM がコンパイルした変数は常に
     <literal>execute_data</literal> 構造体の直後に配置され、
     <literal>execute_data-&gt;CVs</literal> を使わなくても
     基底ポインタ <literal>execute_data</literal> からのオフセットでアクセスできるようになりました。
     マクロ <command>EX_CV_NUM()</command> を使えば、コンパイルされた変数に対して数字を使ってアクセスできます。
    </simpara>
   </listitem>
  </itemizedlist>
 </sect1>
</appendix>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
